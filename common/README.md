Common code used for both datasets.